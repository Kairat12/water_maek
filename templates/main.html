{% include 'base.html' %}
{% load static %}
{% block content %}

    <div class="container mb-5">
        <h3 class="h3 mt-4">Данные на {{ rpv5.record_time|date:"d.m.Y H:s" }}</h3>
        <div class="top_pipes__blocks">
            <div class="row align-items-end">
                <div class="col-3 top__pipe">
                </div>
                <div class="col-3 top__pipe">
                    <div class="border border-1 border-dark marka__b">
                        <div class="rpv__subtitle">
                            ДОП с ЗПД, марка Б
                        </div>
                        <div class="rpv__subtitle__value">1019.2 м3/ч</div>
                    </div>
                    <div class="pipe pipe_height"></div>
                </div>
                <div class="col-3 top__pipe">
                </div>
                <div class="col-3 top__pipe">
                    <div class="d-flex align-items-center">
                        <div class="pipe_corner pipe_corner_rotate top__pipe__corner"></div>
                        <div class="border border-1 border-dark marka__b">
                            <div class="rpv__subtitle">
                                О.З Каспий
                            </div>
                            <div class="rpv__subtitle__value">46.5 м3/ч</div>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="pipe pipe_height" style="height: 90px"></div>
                        <div class="pipe pipe_width" style="width: 30px;"></div>
                        <div class="border border-1 border-dark marka__b">
                            <div class="rpv__subtitle">
                                ДОП с ЗПД, марка А
                            </div>
                            <div class="rpv__subtitle__value">1019.2 м3/ч</div>
                        </div>
                    </div>
                    <div class="pipe pipe_height"></div>
                </div>
            </div>
        </div>
        <div class="header_pipes">
            <div class="row">
                <div class="col-3 header_pipe_corner">
                    <div class="pipe_corner pipe_corner_rotate pipe_corner_rotate_top"></div>
                    <div class="pipe pipe_width"></div>
                </div>
                <div class="col-3 header_pipe_corner header_pipe_corner_center">
                    <div class="pipe pipe_width"></div>
                    <div class="pipe_corner pipe_corner_rotate_top "></div>
                </div>
                <div class="col-3 header_pipe_corner">
                    <div class="pipe_corner pipe_corner_rotate pipe_corner_rotate_top"></div>
                    <div class="pipe pipe_width"></div>
                </div>
                <div class="col-3 header_pipe_corner header_pipe_corner_center">
                    <div class="pipe pipe_width"></div>
                    <div class="pipe_corner pipe_corner_rotate_top "></div>
                </div>
            </div>
        </div>
        <div class="rppv__blocks">
            <div class="row">
                <div class="col-3">
                    <div>
                        <div class="rpv__title">
                            <div>РППВ 1</div>
                        </div>
                        <div class="chart_block">

                            <div class="">
                                <div class="border border-1 border-dark me-2">
                                    {#                                    <div class="rpv__subtitle">#}
                                    {#                                        t<sub>(0,5)</sub>#}
                                    {#                                    </div>#}
                                    {#                                    <div class="rpv__subtitle__value" id="rppv1_time_1"></div>#}
                                    <div class="rpv__subtitle">
                                        Уровень
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv1_value"></div>
                                    <div class="rpv__subtitle">
                                        Объём
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv1_volume"></div>

                                </div>
                            </div>
                            <canvas id="rppv-1" width="300" height="400"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div>
                        <div class="rpv__title">
                            <div>РППВ 2</div>
                        </div>
                        <div class="chart_block">

                            <div class="">
                                <div class="border border-1 border-dark me-2">
                                    {#                                    <div class="rpv__subtitle">#}
                                    {#                                        t<sub>(0,5)</sub>#}
                                    {#                                    </div>#}
                                    {#                                    <div class="rpv__subtitle__value" id="rppv2_time_1"></div>#}
                                    {#                                    <div class="rpv__subtitle__value" id="rppv2_time_2"></div>#}
                                    <div class="rpv__subtitle">
                                        Уровень
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv2_value"></div>
                                    <div class="rpv__subtitle">
                                        Объём
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv2_volume"></div>

                                </div>
                            </div>
                            <canvas id="rppv-2" width="300" height="400"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div>
                        <div class="rpv__title">
                            <div>БРД 3</div>
                        </div>
                        <div class="chart_block">

                            <div class="">
                                <div class="border border-1 border-dark me-2">
                                    {#                                    <div class="rpv__subtitle">#}
                                    {#                                        t<sub>(1,675)</sub>#}
                                    {#                                    </div>#}
                                    {#                                    <div class="rpv__subtitle__value" id="brd3_time_1"></div>#}
                                    {#                                    <div class="rpv__subtitle__value" id="brd3_time_2"></div>#}
                                    <div class="rpv__subtitle">
                                        Уровень
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd3_value"></div>
                                    <div class="rpv__subtitle">
                                        Объём
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd3_volume"></div>

                                </div>
                            </div>
                            <canvas id="brd-3" width="300" height="400"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div>
                        <div class="rpv__title">
                            <div>БРД 4</div>
                        </div>
                        <div class="chart_block">

                            <div class="">
                                <div class="border border-1 border-dark me-2">
                                    {#                                    <div class="rpv__subtitle">#}
                                    {#                                        t<sub>(1,675)</sub>#}
                                    {#                                    </div>#}
                                    {#                                    <div class="rpv__subtitle__value" id="brd4_time_1"></div>#}
                                    {#                                    <div class="rpv__subtitle__value" id="brd4_time_2"></div>#}
                                    <div class="rpv__subtitle">
                                        Уровень
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd4_value"></div>
                                    <div class="rpv__subtitle">
                                        Объём
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd4_volume"></div>

                                </div>
                            </div>
                            <canvas id="brd-4" width="300" height="400"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="d-flex rppv__pipes">
                <div class="pipe_corner pipe_corner_rotate"></div>
                <div class="pipe pipe_width col-3 additional_pipe_top"></div>
                <div class="pipe pipe_width col-3 additional_pipe_top"></div>
                <div class="pipe pipe_width col-3 additional_pipe_top"></div>
                <div class="pipe pipe_width col-1"></div>
                <div class="pipe_corner pipe_corner_rotate pipe_corner_rotate_top"></div>
            </div>

        </div>
        <div class="sppv-75__block position-relative">
            <div class="pipe pipe_height" style="height: 150px"></div>
            <div class="d-flex align-items-center">
                <div class="sppv-75">СППВ-75</div>
                <div><h5 class="h4 ms-4">Выработка питьевой воды: <b>2093 м3/ч</b></h5></div>
                <table class="table  table-bordered border-dark position-absolute end-0 w-25">
                    <thead class="thead-dark">
                    <tr>
                        <th colspan="">Время</th>
                        <th colspan="">Выработка</th>
                        <th colspan="">Распределение</th>
                        <th colspan="">Состояние</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>00:00</td>
                        <td>2090</td>
                        <td>1897</td>
                        <td style="background: green; color: #FFFFFF; text-align: center">&#9650;</td>
                    </tr>
                    <tr>
                        <td>02:00</td>
                        <td>2090</td>
                        <td>1897</td>
                        <td style="background: gray; color: #FFFFFF; text-align: center"> &#10040;</td>
                    </tr>
                    <tr>
                        <td>01:00</td>
                        <td>2090</td>
                        <td>1897</td>
                        <td style="background: red; color: #FFFFFF; text-align: center">&#9660;</td>
                    </tr>
                    <tr>
                        <td>03:00</td>
                        <td>2090</td>
                        <td>1897</td>
                        <td style="background: green; color: #FFFFFF; text-align: center">&#9650;</td>
                    </tr>
                    <tr class="font-weight-bold">
                        <td>04:00</td>
                        <td>2090</td>
                        <td>1897</td>
                        <td style="background: green; color: #FFFFFF; text-align: center">&#9650;</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="pipe pipe_height" style="height: 150px"></div>
            <div class="row d-flex align-items-end ms-0 me-0">
                <div class="pipe_corner"></div>
                <div class="pipe pipe_width col-4 additional_pipe"></div>
                <div class="pipe pipe_width col-4 additional_pipe"></div>
                <div class="pipe pipe_width  additional_pipe__last"></div>
                <div class="pipe_corner pipe_corner_rotate"></div>
            </div>
        </div>
        <div class="d-flex">
            <div class="col rpv__block">
                <div class="rpv__title">
                    <div>РПВ 5</div>
                </div>
                <div class="chart_block">
                    <div class="">
                        <div class="border border-1 border-dark me-2">
                            <div class="rpv__subtitle">
                                t<sub>1(1,29)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv5_time_1"></div>
                            <div class="rpv__subtitle">
                                t<sub>2(1,09)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv5_time_2"></div>
                            <div class="rpv__subtitle">
                                Уровень
                            </div>
                            <div class="rpv__subtitle__value" id="rpv5_value"></div>
                            <div class="rpv__subtitle">
                                Объём
                            </div>
                            <div class="rpv__subtitle__value" id="rpv5_volume"></div>

                        </div>
                    </div>
                    <canvas id="chart1" width="400" height="400"></canvas>
                </div>
            </div>
            <div class="col rpv__block">
                <div class="rpv__title">
                    <div>РПВ 6</div>
                </div>
                <div class="chart_block">
                    <div class="">
                        <div class="border border-1 border-dark me-2">
                            <div class="rpv__subtitle">
                                t<sub>1(1,29)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv6_time_1"></div>
                            <div class="rpv__subtitle">
                                t<sub>2(1,09)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv6_time_2"></div>
                            <div class="rpv__subtitle">
                                Уровень
                            </div>
                            <div class="rpv__subtitle__value" id="rpv6_value"></div>
                            <div class="rpv__subtitle">
                                Объём
                            </div>
                            <div class="rpv__subtitle__value" id="rpv6_volume"></div>
                        </div>
                    </div>
                    <canvas id="chart2" width="400" height="400"></canvas>
                </div>
            </div>
            <div class="col rpv__block ">
                <div class="rpv__title">
                    <div>РПВ 7</div>
                </div>
                <div class="chart_block">
                    <div class="">
                        <div class="border border-1 border-dark me-2">
                            <div class="rpv__subtitle">
                                t<sub>1(1,59)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_time_1"></div>
                            <div class="rpv__subtitle">
                                t<sub>2(1,39)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_time_2"></div>
                            <div class="rpv__subtitle">
                                Уровень
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_value"></div>
                            <div class="rpv__subtitle">
                                Объём
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_volume"></div>

                        </div>
                    </div>
                    <canvas id="chart3" width="400" height="400"></canvas>
                </div>
            </div>
        </div>
        <div class="row d-flex align-items-end ms-0 me-0">
            <div class="pipe pipe_width col-2 additional_pipe_top"></div>
            <div class="pipe pipe_width col-4 additional_pipe_top additional_pipe_top2 "></div>
            <div class="pipe pipe_width col-4 additional_pipe_top additional_pipe_top2"></div>
            <div class="pipe pipe_width col-2  additional_pipe_top3"></div>
        </div>
        {% if other_rpv %}
            <div class="d-flex align-items-start after__charts">
                <div class="d-flex block__pipe__connect flex-column">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                ЦУВС-2 - ЦУВС-3
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.tsuvs2 }} м3/ч</div>
                        </div>
                    </div>
                    <div class="pipe pipe_height"></div>
                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                ЦУВС-3 - город
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.tsuvs3 }} м3/ч</div>
                        </div>
                    </div>
                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                Зад.85- ТЭЦ-1
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.tes1 }} м3/ч</div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                Пром. Зона
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.prom_zona }} м3/ч</div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                ЦУВС-2-ЦУВС- 4
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.tsuvs4 }} м3/ч</div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                Приозерный
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.pri_ozerny }} м3/ч
                                (счетчик)
                            </div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                СЭЗ морпорт
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.mor_port }} м3/ч
                                (счётчик)
                            </div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                КазГазАймак
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.kaz_gaz_aimak }} м3/ч
                                (счетчик)
                            </div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                Каспий Эколоджи
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.kaspi_ecology }} м3/ч
                                (счетчик)
                            </div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                Собственные нужды
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.sn }} м3/ч</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="h4 mt-3 text-center">Общее потребление питьевой воды: <b>2275 м3/ч </b></div>
        {% endif %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.0"></script>
    <script src="{% static 'journal/js/main_chart.js' %}"></script>
    <script>
        const ctx1 = document.getElementById('chart1').getContext('2d');
        const ctx2 = document.getElementById('chart2').getContext('2d');
        const ctx3 = document.getElementById('chart3').getContext('2d');
        const ctx_rppv1 = document.getElementById('rppv-1').getContext('2d');
        const ctx_rppv2 = document.getElementById('rppv-2').getContext('2d');
        const ctx_brd3 = document.getElementById('brd-3').getContext('2d');
        const ctx_brd4 = document.getElementById('brd-4').getContext('2d');
        let rpv5_value, rpv5_consumption, rpv5_pressure, rpv5_volume;
        {% if rpv5.value is None %}
            rpv5_value = null; // Присваиваем null, если значение None
        {% else %}
            rpv5_value = parseFloat('{{ rpv5.value }}'.replace(',', '.'));
            rpv5_volume = parseFloat('{{ rpv5.volume }}'.replace(',', '.'));
            let rpv5_value_block = document.getElementById('rpv5_value');
            let rpv5_volume_block = document.getElementById('rpv5_volume');
            if (rpv5_value_block && rpv5_volume_block) {
                rpv5_value_block.textContent = rpv5_value + ' м'
                rpv5_volume_block.textContent = rpv5_volume * 1000 + ' м3'
            }
        {% endif %}
        let rpv6_value, rpv6_consumption, rpv6_pressure, rpv6_volume;
        {% if rpv6.value is None %}
            rpv6_value = null; // Присваиваем null, если значение None
        {% else %}
            rpv6_value = parseFloat('{{ rpv6.value }}'.replace(',', '.'));
            rpv6_volume = parseFloat('{{ rpv6.volume }}'.replace(',', '.'));
            let rpv6_value_block = document.getElementById('rpv6_value');
            let rpv6_volume_block = document.getElementById('rpv6_volume');
            if (rpv6_value_block && rpv6_volume_block) {
                rpv6_value_block.textContent = rpv6_value + ' м'
                rpv6_volume_block.textContent = rpv6_volume * 1000 + ' м3'
            }
        {% endif %}
        let rpv7_value, rpv7_volume;
        {% if rpv7.value is None %}
            rpv7_value = null; // Присваиваем null, если значение None
        {% else %}
            rpv7_value = parseFloat('{{ rpv7.value }}'.replace(',', '.'));
            rpv7_volume = parseFloat('{{ rpv7.volume }}'.replace(',', '.'));
            let rpv7_value_block = document.getElementById('rpv7_value');
            let rpv7_volume_block = document.getElementById('rpv7_volume');
            if (rpv7_value_block && rpv7_volume_block) {
                rpv7_value_block.textContent = rpv7_value + ' м'
                rpv7_volume_block.textContent = rpv7_volume * 1000 + ' м3'
            }
        {% endif %}
        let rppv1_value, rppv1_consumption, rppv1_pressure, rppv1_volume;
        {% if rpvv1.level is None %}
            rppv1_value = null; // Присваиваем null, если значение None
        {% else %}
            rppv1_value = parseFloat('{{ rpvv1.level }}'.replace(',', '.'));
            rppv1_volume = parseFloat('{{ rpvv1.volume }}'.replace(',', '.'));
            let rppv1_value_block = document.getElementById('rppv1_value');
            let rppv1_volume_block = document.getElementById('rppv1_volume');
            if (rppv1_value_block && rppv1_volume_block) {
                rppv1_value_block.textContent = rppv1_value + ' м'
                rppv1_volume_block.textContent = rppv1_value * 1000 + ' м3'
            }
        {% endif %}

        let rppv2_value, rppv2_consumption, rppv2_pressure, rppv2_volume;
        {% if rpvv2.level is None %}
            rppv2_value = null; // Присваиваем null, если значение None
        {% else %}
            rppv2_value = parseFloat('{{ rpvv2.level }}'.replace(',', '.'));
            rppv2_volume = parseFloat('{{ rpvv2.volume }}'.replace(',', '.'));
            let rppv2_value_block = document.getElementById('rppv2_value');
            let rppv2_volume_block = document.getElementById('rppv2_volume');
            if (rppv2_value_block && rppv2_volume_block) {
                rppv2_value_block.textContent = rppv2_value + ' м'
                rppv2_volume_block.textContent = rppv2_value * 1000 + ' м3'
            }
        {% endif %}

        let brd3_value, brd3_consumption, brd3_pressure, brd3_volume;
        {% if brd3.level is None %}
            brd3_value = null; // Присваиваем null, если значение None
        {% else %}
            brd3_value = parseFloat('{{ brd3.level }}'.replace(',', '.'));
            brd3_volume = parseFloat('{{ brd3.volume }}'.replace(',', '.'));
            let brd3_value_block = document.getElementById('brd3_value');
            let brd3_volume_block = document.getElementById('brd3_volume');
            if (brd3_value_block && brd3_volume_block) {
                brd3_value_block.textContent = brd3_value + ' м'
                brd3_volume_block.textContent = brd3_value * 1000 + ' м3'
            }
        {% endif %}
        let brd4_value, brd4_consumption, brd4_pressure, brd4_volume;
        {% if brd4.level is None %}
            brd4_value = null; // Присваиваем null, если значение None
        {% else %}
            brd4_value = parseFloat('{{ brd4.level }}'.replace(',', '.'));
            brd4_volume = parseFloat('{{ brd4.volume }}'.replace(',', '.'));
            let brd4_value_block = document.getElementById('brd4_value');
            let brd4_volume_block = document.getElementById('brd4_volume');
            if (brd4_value_block && brd4_volume_block) {
                brd4_value_block.textContent = brd4_value + ' м'
                brd4_volume_block.textContent = brd4_value * 1000 + ' м3'
            }
        {% endif %}

        createChart(ctx1, 'РПВ-5', rpv5_value, 1.09, 1.29, 4300, 5100);
        createChart(ctx2, 'РПВ-6', rpv6_value, 1.09, 1.29, 4300, 5100);
        createChart(ctx3, 'РПВ-7', rpv7_value, 1.39, 1.59, 5500, 6300);
        createChart(ctx_rppv1, 'РППВ-1', rppv1_value, 0.5, 0, 0, 2000);
        createChart(ctx_rppv2, 'РППВ-2', rppv2_value, 0.5, 0, 0, 2000);
        createChart(ctx_brd3, 'БРД-3', brd3_value, 1.675, 0, 0, 6650);
        createChart(ctx_brd4, 'БРД-4', brd4_value, 1.675, 0, 0, 6650);


        updateTime('rpv5_time_1', 'rpv5_time_2', rpv5_volume, 5100, 4300);
        updateTime('rpv6_time_1', 'rpv6_time_2', rpv6_volume, 5100, 4300);
        updateTime('rpv7_time_1', 'rpv7_time_2', rpv7_volume, 6300, 5500);
        {#updateTime('rppv1_time_1', '', rppv1_volume, 5100, 4300);#}
        {#updateTime('rppv2_time_1', '', rppv2_volume, 5100, 4300);#}
    </script>
{% endblock %}