{% include 'base.html' %}
{% load static %}
{% block content %}
    <style>
        .sppv-75__block {

        }

        .sppv-75 {
            background: #0f5132;
            color: #ffd85f;
            padding: 25px;
            font-size: 20px;
            width: 250px;
            text-align: center;
        }

        .chart_block {
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #bdbdbd;
            padding: 20px;
            border-radius: 5px;
        }

        .chart_block canvas {
            width: 80%;
        }

        .pipe {

            background: linear-gradient(to right, #bdbdbd, white, #bdbdbd);
            border: 1px solid;
        }

        .pipe_height {
            height: 30px;
            width: 30px;
            border-bottom: none;
        }

        .pipe_corner {
            position: relative;
            width: 60px;
            height: 60px;
        }

        .pipe_corner::after {
            content: '';
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            border: 1px solid;
            border-top: none;
            border-right: none;
            border-radius: 0% 0% 0% 100%;
            background: linear-gradient(to right, #bdbdbd, white, #bdbdbd);
        }

        .pipe_corner::before {
            content: '';
            width: 30px;
            height: 30px;
            position: absolute;
            top: 0;
            right: 0;
            border-left: 1px solid;
            border-bottom: 1px solid;
            z-index: 2;
            background: white;
            border-radius: 0% 0% 0% 100%;
        }

        .pipe_width {
            height: 30px;
            border-left: none;
            border-right: none;
            background: linear-gradient(to bottom, #bdbdbd, white, #bdbdbd);
        }

        .additional_pipe, .additional_pipe_top {
            position: relative;
        }

        .additional_pipe:after, .additional_pipe_top:after {
            content: '';
            position: absolute;
            top: 100%;
            left: 37%;
            background: linear-gradient(to right, #bdbdbd, white, #bdbdbd);
            height: 31px;
            width: 30px;
            border: 1px solid;
        }

        .additional_pipe:after {
            border-top: none;
        }

        .additional_pipe_top:after {
            top: auto;
            bottom: 100%;
            left: 90%;
            border-bottom: none;
        }

        .additional_pipe_top2:after {
            left: 96%;
        }

        .additional_pipe_top2 {
            margin-top: 30px;
        }

        .additional_pipe__last {
            width: 10.3%;
        }

        .pipe_corner_rotate {
            transform: rotate(180deg);
            translate: 0 30px;
        }

        .rpv__title {
            font-size: 1.2rem;
            color: #ffd85f;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rpv__title div {
            padding: 10px 40px;
            background: #003460;
        }

        .rpv__block {
            margin-top: 30px;
        }

        .rpv__subtitle {
            background: #4f4f4f;
            color: #FFFFFF;
            padding: 5px 10px;
        }

        .rpv__subtitle__value {
            background: #FFFFFF;
            color: #0a53be;
            padding: 4px 10px;
            font-weight: 600;
        }

        .after__charts {
            margin-top: 30px;
            gap: 39px;
        {#flex-direction: column;#}
        }

        .after__charts .pipe_height {
            height: 50px;
            border-top: none;
        }

        .block__pipe__connect {
            align-items: center;
            position: relative;
        }

        .block__pipe__connect::after {
            content: '';
            position: absolute;
            top: -30px;
            left: 37%;
            background: linear-gradient(to right, #bdbdbd, white, #bdbdbd);
            height: 31px;
            width: 30px;
            border: 1px solid;
            border-top: none;
        }

        .block__pipe__connect .pipe_height {
            height: 100px;
        }

        .block__pipe__connect .pipe_width {
            width: 60px;
        }

        .rppv__blocks .pipe_corner_rotate {
            transform: rotate(90deg);
            translate: 0;
        }

        .rppv__blocks .col-3 {
            padding: 0;
        }

        .rppv__pipes {
            margin-top: 30px;
        }

        .rppv__pipes .additional_pipe_top::after {
            left: 43%;
        }

        .rppv__pipes .pipe_corner_rotate_top {
            transform: rotate(270deg);
            translate: 0 -30px;
        }

        .header_pipes .pipe_corner_rotate {
            translate: 0;
            transform: rotate(90deg);
        }

        .header_pipe_corner {
            display: flex;
            justify-content: flex-end;
            padding: 0;
            align-items: start;
        }

        .header_pipe_corner .pipe_width {
            width: 40%;
        }

        .header_pipe_corner_center {
            justify-content: flex-start;
        }

        .header_pipe_corner_center .pipe_height {
            height: 60px;
        }

        .header_pipe_corner_center .pipe_width {
            width: 44%;
        }

        .top__pipe {
            padding: 0;
        }

    </style>
    <div class="container mb-5">
        <h3 class="h3 mt-4">Данные на {{ rpv5.record_time|date:"d.m.Y H:s" }}</h3>
        <div class="top_pipes__blocks">
            <div class="row">
                <div class="col-3 top__pipe">

                </div>
                <div class="col-3 top__pipe">
                    <div class="pipe pipe_height"></div>
                </div>
            </div>
        </div>
        <div class="header_pipes">
            <div class="row">
                <div class="col-3 header_pipe_corner">
                    <div class="pipe_corner pipe_corner_rotate pipe_corner_rotate_top"></div>
                    <div class="pipe pipe_width"></div>
                </div>
                <div class="col-3 header_pipe_corner header_pipe_corner_center">
                    <div class="pipe pipe_width"></div>
                    <div class="pipe pipe_height"></div>
                </div>
                <div class="col-3 header_pipe_corner"></div>
                <div class="col-3 header_pipe_corner"></div>
            </div>
        </div>
        <div class="rppv__blocks">
            <div class="row">
                <div class="col-3">
                    <div>
                        <div class="rpv__title">
                            <div>РППВ 1</div>
                        </div>
                        <div class="chart_block">

                            <div class="">
                                <div class="border border-1 border-dark me-2">
                                    <div class="rpv__subtitle">
                                        t<sub>1(1,29)</sub>
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv1_time_1"></div>
                                    <div class="rpv__subtitle">
                                        t<sub>2(1,09)</sub>
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv1_time_2"></div>
                                    <div class="rpv__subtitle">
                                        Уровень
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv1_value"></div>
                                    <div class="rpv__subtitle">
                                        Объём
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv1_volume"></div>

                                </div>
                            </div>
                            <canvas id="rppv-1" width="300" height="400"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div>
                        <div class="rpv__title">
                            <div>РППВ 2</div>
                        </div>
                        <div class="chart_block">

                            <div class="">
                                <div class="border border-1 border-dark me-2">
                                    <div class="rpv__subtitle">
                                        t<sub>1(1,29)</sub>
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv2_time_1"></div>
                                    <div class="rpv__subtitle">
                                        t<sub>2(1,09)</sub>
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv2_time_2"></div>
                                    <div class="rpv__subtitle">
                                        Уровень
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv2_value"></div>
                                    <div class="rpv__subtitle">
                                        Объём
                                    </div>
                                    <div class="rpv__subtitle__value" id="rppv2_volume"></div>

                                </div>
                            </div>
                            <canvas id="rppv-2" width="300" height="400"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div>
                        <div class="rpv__title">
                            <div>БРД 3</div>
                        </div>
                        <div class="chart_block">

                            <div class="">
                                <div class="border border-1 border-dark me-2">
                                    <div class="rpv__subtitle">
                                        t<sub>1(1,29)</sub>
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd3_time_1"></div>
                                    <div class="rpv__subtitle">
                                        t<sub>2(1,09)</sub>
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd3_time_2"></div>
                                    <div class="rpv__subtitle">
                                        Уровень
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd3_value"></div>
                                    <div class="rpv__subtitle">
                                        Объём
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd3_volume"></div>

                                </div>
                            </div>
                            <canvas id="brd-3" width="300" height="400"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div>
                        <div class="rpv__title">
                            <div>БРД 4</div>
                        </div>
                        <div class="chart_block">

                            <div class="">
                                <div class="border border-1 border-dark me-2">
                                    <div class="rpv__subtitle">
                                        t<sub>1(1,29)</sub>
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd4_time_1"></div>
                                    <div class="rpv__subtitle">
                                        t<sub>2(1,09)</sub>
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd4_time_2"></div>
                                    <div class="rpv__subtitle">
                                        Уровень
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd4_value"></div>
                                    <div class="rpv__subtitle">
                                        Объём
                                    </div>
                                    <div class="rpv__subtitle__value" id="brd4_volume"></div>

                                </div>
                            </div>
                            <canvas id="brd-4" width="300" height="400"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="d-flex rppv__pipes">
                <div class="pipe_corner pipe_corner_rotate"></div>
                <div class="pipe pipe_width col-3 additional_pipe_top"></div>
                <div class="pipe pipe_width col-3 additional_pipe_top"></div>
                <div class="pipe pipe_width col-3 additional_pipe_top"></div>
                <div class="pipe pipe_width col-1"></div>
                <div class="pipe_corner pipe_corner_rotate pipe_corner_rotate_top"></div>
            </div>

        </div>
        <div class="sppv-75__block position-relative">
            <div class="pipe pipe_height" style="height: 150px"></div>
            <div class="d-flex align-items-center">
                <div class="sppv-75">СППВ-75</div>
                <div><h5 class="h4 ms-4">Выработка питьевой воды: <b>2093 м3/ч</b></h5></div>
                <table class="table  table-bordered position-absolute end-0 w-25">
                    <thead class="thead-dark">
                    <tr>
                        <th colspan="">Время</th>
                        <th colspan="">Выработка</th>
                        <th colspan="">Распределение</th>
                        <th colspan="">Состояние</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>00:00</td>
                        <td>2090</td>
                        <td>1897</td>
                        <td style="background: green; color: #FFFFFF">&uArr;</td>
                    </tr>
                    <tr>
                        <td>01:00</td>
                        <td>2090</td>
                        <td>1897</td>
                        <td style="background: green; color: #FFFFFF">&uArr;</td>
                    </tr>
                    <tr>
                        <td>02:00</td>
                        <td>2090</td>
                        <td>1897</td>
                        <td style="background: green; color: #FFFFFF">&uArr;</td>
                    </tr>
                    <tr>
                        <td>03:00</td>
                        <td>2090</td>
                        <td>1897</td>
                        <td style="background: green; color: #FFFFFF">&uArr;</td>
                    </tr>
                    <tr class="font-weight-bold">
                        <td>04:00</td>
                        <td>2090</td>
                        <td>1897</td>
                        <td style="background: green; color: #FFFFFF">&uArr;</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="pipe pipe_height" style="height: 150px"></div>
            <div class="row d-flex align-items-end ms-0 me-0">
                <div class="pipe_corner"></div>
                <div class="pipe pipe_width col-4 additional_pipe"></div>
                <div class="pipe pipe_width col-4 additional_pipe"></div>
                <div class="pipe pipe_width  additional_pipe__last"></div>
                <div class="pipe_corner pipe_corner_rotate"></div>
            </div>
        </div>
        <div class="d-flex">
            <div class="col rpv__block">
                <div class="rpv__title">
                    <div>РПВ 5</div>
                </div>
                <div class="chart_block">
                    <div class="">
                        <div class="border border-1 border-dark me-2">
                            <div class="rpv__subtitle">
                                t<sub>1(1,29)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv5_time_1"></div>
                            <div class="rpv__subtitle">
                                t<sub>2(1,09)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv5_time_2"></div>
                            <div class="rpv__subtitle">
                                Уровень
                            </div>
                            <div class="rpv__subtitle__value" id="rpv5_value"></div>
                            <div class="rpv__subtitle">
                                Объём
                            </div>
                            <div class="rpv__subtitle__value" id="rpv5_volume"></div>

                        </div>
                    </div>
                    <canvas id="chart1" width="400" height="400"></canvas>
                </div>
            </div>
            <div class="col rpv__block">
                <div class="rpv__title">
                    <div>РПВ 6</div>
                </div>
                <div class="chart_block">
                    <div class="">
                        <div class="border border-1 border-dark me-2">
                            <div class="rpv__subtitle">
                                t<sub>1(1,29)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv6_time_1"></div>
                            <div class="rpv__subtitle">
                                t<sub>2(1,09)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv6_time_2"></div>
                            <div class="rpv__subtitle">
                                Уровень
                            </div>
                            <div class="rpv__subtitle__value" id="rpv6_value"></div>
                            <div class="rpv__subtitle">
                                Объём
                            </div>
                            <div class="rpv__subtitle__value" id="rpv6_volume"></div>
                        </div>
                    </div>
                    <canvas id="chart2" width="400" height="400"></canvas>
                </div>
            </div>
            <div class="col rpv__block ">
                <div class="rpv__title">
                    <div>РПВ 7</div>
                </div>
                <div class="chart_block">
                    <div class="">
                        <div class="border border-1 border-dark me-2">
                            <div class="rpv__subtitle">
                                t<sub>1(1,59)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_time_1"></div>
                            <div class="rpv__subtitle">
                                t<sub>2(1,39)</sub>
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_time_2"></div>
                            <div class="rpv__subtitle">
                                Уровень
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_value"></div>
                            <div class="rpv__subtitle">
                                Объём
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_volume"></div>

                        </div>
                    </div>
                    <canvas id="chart3" width="400" height="400"></canvas>
                </div>
            </div>
        </div>
        <div class="row d-flex align-items-end ms-0 me-0">
            <div class="pipe pipe_width col-2 additional_pipe_top"></div>
            <div class="pipe pipe_width col-4 additional_pipe_top additional_pipe_top2 "></div>
            <div class="pipe pipe_width col-4 additional_pipe_top additional_pipe_top2"></div>
            <div class="pipe pipe_width col-2  additional_pipe_top3"></div>
        </div>
        {% if other_rpv %}
            <div class="d-flex after__charts">
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                ЦУВС-2 - ЦУВС-3
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.tsuvs2 }} м3/ч</div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                ЦУВС-3 - город
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.tsuvs3 }} м3/ч</div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                Зад.85- ТЭЦ-1
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.tes1 }} м3/ч</div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                Пром. Зона
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.prom_zona }} м3/ч</div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                ЦУВС-2-ЦУВС- 4
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.tsuvs4 }} м3/ч</div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                Приозерный
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.pri_ozerny }} м3/ч
                                (счетчик)
                            </div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                СЭЗ морпорт
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.mor_port }} м3/ч
                                (счётчик)
                            </div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                КазГазАймак
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.kaz_gaz_aimak }} м3/ч
                                (счетчик)
                            </div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                Каспий Эколоджи
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.kaspi_ecology }} м3/ч
                                (счетчик)
                            </div>
                        </div>
                    </div>

                </div>
                <div class="d-flex block__pipe__connect">
                    <div class="">
                        <div class="border border-1 border-dark">
                            <div class="rpv__subtitle">
                                Собственные нужды
                            </div>
                            <div class="rpv__subtitle__value" id="rpv7_pressure">{{ other_rpv.sn }} м3/ч</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="h4 mt-3 text-center">Общее потребление питьевой воды: <b>2275 м3/ч </b></div>
        {% endif %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.0"></script>
    <script>
        // Плагин для закругления верхушек столбиков
        const roundedBarsPlugin = {
            id: 'roundedBars',
            beforeDraw: chart => {
                const {ctx} = chart;
                ctx.save();
                chart.getDatasetMeta(0).data.forEach((bar, index) => {
                    const radius = 20;
                    const {x, y, width, height} = bar;
                    ctx.beginPath();
                    ctx.moveTo(x - width / 2, y);
                    ctx.lineTo(x - width / 2, y + height - radius);
                    ctx.quadraticCurveTo(x - width / 2, y + height, x - width / 2 + radius, y + height);
                    ctx.lineTo(x + width / 2 - radius, y + height);
                    ctx.quadraticCurveTo(x + width / 2, y + height, x + width / 2, y + height - radius);
                    ctx.lineTo(x + width / 2, y);
                    ctx.fillStyle = bar.options.backgroundColor;
                    ctx.fill();
                    ctx.stroke();
                });
                ctx.restore();
            }
        };

        Chart.register(roundedBarsPlugin);

        const createChart = (ctx, label, data, criticalLevel, criticalLevel2, criticalLevelVolume, criticalLevelVolume2) => {
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [label],
                    datasets: [{
                        label: 'Уровень воды (м)',
                        data: [data],
                        backgroundColor: data < criticalLevel ? 'rgba(255, 99, 132, 0.5)' : data < criticalLevel2 ? 'rgba(255,194,7,0.5)' : 'rgba(54, 162, 235, 0.5)',
                        borderWidth: 1,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            barPercentage: 0.5,
                        },
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1,
                                callback: function (value, index, values) {
                                    return value + ' м'; // Метки по высоте
                                }
                            }
                        },

                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: false,
                            text: [label],
                            font: {
                                size: 20
                            },
                        },
                        annotation: {
                            annotations: [
                                {
                                    type: 'line',
                                    scaleID: 'y',
                                    value: criticalLevel, // Критический уровень
                                    borderColor: 'red',
                                    borderWidth: 5,
                                    label: {
                                        content: `${criticalLevel} м, объем ${criticalLevelVolume2} м³`,
                                        enabled: true,
                                        position: 'center',
                                        yAdjust: -20
                                    }
                                },
                                ...(criticalLevel2 !== 0 ? [{
                                    type: 'line',
                                    scaleID: 'y',
                                    value: criticalLevel2, // Критический уровень
                                    borderColor: 'orange',
                                    borderWidth: 5,
                                    label: {
                                        content: `крит. уровень ${criticalLevel2} м, объем ${criticalLevelVolume} м³`,
                                        enabled: true,
                                        position: 'center',
                                        yAdjust: 20,
                                    }
                                }] : [])
                            ]
                        }
                    }
                }
            });
        }

        const ctx1 = document.getElementById('chart1').getContext('2d');
        const ctx2 = document.getElementById('chart2').getContext('2d');
        const ctx3 = document.getElementById('chart3').getContext('2d');
        const ctx_rppv1 = document.getElementById('rppv-1').getContext('2d');
        const ctx_rppv2 = document.getElementById('rppv-2').getContext('2d');
        const ctx_brd3 = document.getElementById('brd-3').getContext('2d');
        const ctx_brd4 = document.getElementById('brd-4').getContext('2d');
        let rpv5_value, rpv5_consumption, rpv5_pressure, rpv5_volume;
        {% if rpv5.value is None %}
            rpv5_value = null; // Присваиваем null, если значение None
        {% else %}
            rpv5_value = parseFloat('{{ rpv5.value }}'.replace(',', '.'));
            rpv5_volume = parseFloat('{{ rpv5.volume }}'.replace(',', '.'));
            let rpv5_value_block = document.getElementById('rpv5_value');
            let rpv5_volume_block = document.getElementById('rpv5_volume');
            if (rpv5_value_block && rpv5_volume_block) {
                rpv5_value_block.textContent = rpv5_value + ' м'
                rpv5_volume_block.textContent = rpv5_volume * 1000 + ' м3'
            }
        {% endif %}
        let rpv6_value, rpv6_consumption, rpv6_pressure, rpv6_volume;
        {% if rpv6.value is None %}
            rpv6_value = null; // Присваиваем null, если значение None
        {% else %}
            rpv6_value = parseFloat('{{ rpv6.value }}'.replace(',', '.'));
            rpv6_volume = parseFloat('{{ rpv6.volume }}'.replace(',', '.'));
            let rpv6_value_block = document.getElementById('rpv6_value');
            let rpv6_volume_block = document.getElementById('rpv6_volume');
            if (rpv6_value_block && rpv6_volume_block) {
                rpv6_value_block.textContent = rpv6_value + ' м'
                rpv6_volume_block.textContent = rpv6_volume * 1000 + ' м3'
            }
        {% endif %}
        let rpv7_value, rpv7_volume;
        {% if rpv7.value is None %}
            rpv7_value = null; // Присваиваем null, если значение None
        {% else %}
            rpv7_value = parseFloat('{{ rpv7.value }}'.replace(',', '.'));
            rpv7_volume = parseFloat('{{ rpv7.volume }}'.replace(',', '.'));
            let rpv7_value_block = document.getElementById('rpv7_value');
            let rpv7_volume_block = document.getElementById('rpv7_volume');
            if (rpv7_value_block && rpv7_volume_block) {
                rpv7_value_block.textContent = rpv7_value + ' м'
                rpv7_volume_block.textContent = rpv7_volume * 1000 + ' м3'
            }
        {% endif %}
        createChart(ctx1, 'РПВ-5', rpv5_value, 1.09, 1.29, 4300, 5100);
        createChart(ctx2, 'РПВ-6', rpv6_value, 1.09, 1.29, 4300, 5100);
        createChart(ctx3, 'РПВ-7', rpv7_value, 1.39, 1.59, 5500, 6300);
        createChart(ctx_rppv1, 'РППВ-1', rpv7_value, 0.5, 0, 0, 2000);
        createChart(ctx_rppv2, 'РППВ-2', rpv7_value, 0.5, 0, 0, 2000);
        createChart(ctx_brd3, 'БРД-3', rpv7_value, 1.675, 0, 0, 6650);
        createChart(ctx_brd4, 'БРД-4', rpv7_value, 1.675, 0, 0, 6650);

        function updateTime(elementId1, elementId2, volume, offset1, offset2) {
            let element1 = document.getElementById(elementId1);
            let element2 = document.getElementById(elementId2);

            if (element1 && element2) {
                let totalHours1 = ((volume * 1000 - offset1) * 3 / 2275);
                let hours1 = Math.floor(totalHours1);
                let minutes1 = Math.floor((totalHours1 - hours1) * 60);
                element1.textContent = hours1 + " час " + minutes1 + " минут";

                let totalHours2 = ((volume * 1000 - offset2) * 3 / 2275);
                let hours2 = Math.floor(totalHours2);
                let minutes2 = Math.floor((totalHours2 - hours2) * 60);
                element2.textContent = hours2 + " час " + minutes2 + " минут";
            }
        }

        updateTime('rpv5_time_1', 'rpv5_time_2', rpv5_volume, 5100, 4300);
        updateTime('rpv6_time_1', 'rpv6_time_2', rpv6_volume, 5100, 4300);
        updateTime('rpv7_time_1', 'rpv7_time_2', rpv7_volume, 6300, 5500);

    </script>
{% endblock %}